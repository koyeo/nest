name: nest

script:
  - name: 测试环境部署脚本
    id: test.sh
    file: test/shell/test.sh
    command:
      - echo "Hello world"

env:
  - name: 测试环境
    id: env-test
    script:
      - env-test-deploy.sh@before
    server:
      - name: 测试服务器
        id: test-node-1
        ip: 47.100.184.133
        ssh:
          port: 2222
          user: root
          password: Helloshic
          identity: ~/.ssh/id_rsa

task:
  - name: 生成器
    id: generator
    watch:
      - test/generator/*.go
    directory: test/generator
    build:
      - env: localhost
        command:
          - go build main.go
  - name: 主程序
    id: main
    watch:
      - test/test.go
      - test/second/**/*.go
    directory: test
    run: go run test.go
    build:
      - env: env-test
        script:
          - env-test@before
          - env-test@after
        command:
          - go build -o test test.go
          - echo "Hello world"
    deploy:
      - env: env-test
        bin: /path/to/bin
        daemon:
          pid: /path/to/pid
          start: ./path/to/bin -s
          logDir: /path/to/log
          logFile: /path/to
        server:
          - test-node-1
        script:
          - env-test-deploy
        command:
          - git pull



