id: nest
name: nest
directory: test

script:
  - name: 测试环境部署脚本
    id: test.sh
    file: test/shell/test.sh
    command:
      - echo "Hello world"

env:
  - name: 测试环境
    id: env-test
    script:
      - env-test-deploy.sh@before
    server:
      - name: 测试服务器
        id: test-node-1
        ip: 47.100.184.133
        ssh:
          port: 2222
          user: root
          password: Helloshic7
          identity: ~/.ssh/id_rsa

task:
  - id: generator
    name: 生成器
    watch:
      - generator/*.go
    build:
      - env: localhost
        command:
          - go build main.go
  - id: main
    name: 主程序
    watch:
      - test.go
      - second/**/*.go
    run: go run test.go
    build:
      - id: build-test
        env: env-test
        script:
          - env-test@before
          - env-test@after
        dist: test
        command:
          - go build -o test test.go
          - echo "Hello world"
    deploy:
      - id: deloy-test
        env: env-test
        bin:
          source: build
          param: build-test
          path: /opt/bin/deploy-test
        daemon:
          pid: /opt/pid/deploy-test.pid
          start: ./path/to/bin -s
          success: ===start success===
          log:
            path: /path/to/log            # 日志文件路径
            file: /path/to/log            # 日志文件名称
            level: info                   # 日志输出等级
            size: 1                       # 单个文件最大限制，单位 M
            backup: 1                     # 最多保留备份数
            age: 1                        # 最多保留天数
            compress: true                # 是否压缩日志
            daily: true                   # 是否按日切割
        server:
          - test-node-1
        script:
          - env-test-deploy@before
        command:
          - git pull



